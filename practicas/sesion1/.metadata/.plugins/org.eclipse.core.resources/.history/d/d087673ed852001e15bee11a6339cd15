package uo.cpm.p2.ui;

import java.awt.BorderLayout;
import java.awt.EventQueue;

import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.border.EmptyBorder;

import uo.cpm.p2.exception.InvalidFieldsException;

import javax.swing.JLabel;
import javax.swing.JOptionPane;

import java.awt.Color;
import javax.swing.JTextField;
import javax.swing.JComboBox;
import javax.swing.JPasswordField;
import javax.swing.JButton;
import javax.swing.DefaultComboBoxModel;
import java.awt.event.ActionListener;
import java.sql.Date;
import java.time.LocalDate;
import java.awt.event.ActionEvent;

public class VentanaRegistro extends JFrame {
	
	private static final int CURRENT_YEAR=2023;

	private JPanel pnContenidos;
	private JLabel lbNombre;
	private JTextField txNombre;
	private JLabel lbYear;
	private JComboBox cbYears;
	private JLabel lbPass;
	private JPasswordField pwPass1;
	private JLabel lbPass2;
	private JPasswordField pwPass2;
	private JButton btSiguiente;
	private JButton btCancelar;

	
	
	/*
	 * Tareas 
	 * 
	 * 1 A�o de nacimiento
	 * 		poner datos al combobox utilizar model 100 a�os
	 * 
	 * 2 programar botones, siempre que se quiera cerrar a la aplicacion existe  system.exit(0)
	 * 	siguiente
	 * 
	 * 
	 * 
	 */
	/**
	 * Launch the application.
	 */
	public static void main(String[] args) {
		//widowBuilder utiliza un hilo para la interfz
		EventQueue.invokeLater(new Runnable() {
			public void run() {
				try {
					VentanaRegistro frame = new VentanaRegistro();
					frame.setVisible(true);
				} catch (Exception e) {
					e.printStackTrace();
				}
			}
		});
	}

	/**
	 * Create the frame.
	 */
	public VentanaRegistro() {
		setTitle("Datos de Registro");
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);//operacion de la x(cerrar) de la ventana
		setBounds(100, 100, 600, 300);
		pnContenidos = new JPanel();
		pnContenidos.setBackground(Color.WHITE);
		pnContenidos.setBorder(new EmptyBorder(5, 5, 5, 5));
		setContentPane(pnContenidos);
		pnContenidos.setLayout(null);
		pnContenidos.add(getLbNombre());
		pnContenidos.add(getTxNombre());
		pnContenidos.add(getLbYear());
		pnContenidos.add(getCbYears());
		pnContenidos.add(getLbPass());
		pnContenidos.add(getPwPass1());
		pnContenidos.add(getLbPass2());
		pnContenidos.add(getPwPass2());
		pnContenidos.add(getBtSiguiente());
		pnContenidos.add(getBtCancelar());
		setLocationRelativeTo(null);
	}
	private JLabel getLbNombre() {
		if (lbNombre == null) {
			lbNombre = new JLabel("Nombre y apellidos");
			lbNombre.setBounds(51, 31, 106, 14);
		}
		return lbNombre;
	}
	private JTextField getTxNombre() {
		if (txNombre == null) {
			txNombre = new JTextField();
			txNombre.setBounds(220, 28, 120, 20);
			txNombre.setColumns(10);
		}
		return txNombre;
	}
	private JLabel getLbYear() {
		if (lbYear == null) {
			lbYear = new JLabel("A\u00F1o de nacimiento");
			lbYear.setBounds(51, 65, 106, 14);
		}
		return lbYear;
	}
	private JComboBox getCbYears() {
		if (cbYears == null) {
			cbYears = new JComboBox<String>();
			cbYears.setModel(new DefaultComboBoxModel(getYears()));//tarea 1 utilizar programacion
			cbYears.setBounds(220, 61, 86, 22);
		}
		return cbYears;
	}
	
	/**
	 * Establece una lista de string con los 100
	 * @return a string list with 100 years
	 */
	private String[] getYears() {
		String[] years = new String[100];
		for (int i=0; i<100;i++) {
			Integer year = CURRENT_YEAR-i;
			years[i]= year.toString();
		}
		return years;
	}
	
	
	private JLabel getLbPass() {
		if (lbPass == null) {
			lbPass = new JLabel("Password:");
			lbPass.setBounds(51, 96, 106, 14);
		}
		return lbPass;
	}
	private JPasswordField getPwPass1() {
		if (pwPass1 == null) {
			pwPass1 = new JPasswordField();
			pwPass1.setBounds(220, 94, 120, 14);
		}
		return pwPass1;
	}
	private JLabel getLbPass2() {
		if (lbPass2 == null) {
			lbPass2 = new JLabel("Reinserte Password:");
			lbPass2.setBounds(51, 133, 106, 14);
		}
		return lbPass2;
	}
	private JPasswordField getPwPass2() {
		if (pwPass2 == null) {
			pwPass2 = new JPasswordField();
			pwPass2.setBounds(220, 133, 120, 14);
		}
		return pwPass2;
	}
	private JButton getBtSiguiente() {
		if (btSiguiente == null) {
			btSiguiente = new JButton("Siguiente");
			btSiguiente.addActionListener(new ActionListener() {
				public void actionPerformed(ActionEvent e) {
					try {
						checkFields();
					}catch(InvalidFieldsException exception) {
						JOptionPane.showMessageDialog(null, exception.getMessage(),"Revise datos",1);
					}
					
				}
			});
			btSiguiente.setBounds(368, 216, 89, 23);
		}
		return btSiguiente;
	}
	
	/**
	 * Comprueba que los campos sean correctos
	 * @return
	 */
	private void checkFields() throws InvalidFieldsException{
		checkName(txNombre.getText());
		checkPassword(parseCharToString(pwPass1.getPassword()),parseCharToString(pwPass2.getPassword()));
	}
	
	/**
	 * Se comprueba que el nombre no este vacio
	 * @throws InvalidFieldsException if name is empty
	 */
	private void checkName(String name) throws InvalidFieldsException {
		if(name.isEmpty() || name.isBlank()) {
			throw new InvalidFieldsException("Campos obligatorios: El nombre no puede estar vacio");
		}
	}
	
	/**
	 * Parse una lista de char a String
	 * @param char[] list a parsear
	 * @return string
	 */
	private String parseCharToString(char[] list) {
		return String.valueOf(list);
	}
	
	/**
	 * Compara si las dos contraseñas son iguales
	 * @throws InvalidFieldsException si las contraseñas no son iguales
	 */
	private void checkPassword(String password1, String password2) throws InvalidFieldsException {
		if(!password1.equals(password2)) {
			throw new InvalidFieldsException("Las contraseñas no coinciden");
		}
	}
	
	private JButton getBtCancelar() {
		if (btCancelar == null) {
			btCancelar = new JButton("Cancelar");
			btCancelar.addActionListener(new ActionListener() {
				public void actionPerformed(ActionEvent e) {
					//System.exit(0);
					finalizar();
				}
			});
			btCancelar.setBounds(467, 216, 89, 23);
		}
		return btCancelar;
	}
	
	private void finalizar() {
		System.exit(0);
	}
}
